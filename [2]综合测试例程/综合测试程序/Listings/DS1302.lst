C51 COMPILER V9.59.0.0   DS1302                                                            01/16/2025 15:48:23 PAGE 1   


C51 COMPILER V9.59.0.0, COMPILATION OF MODULE DS1302
OBJECT MODULE PLACED IN .\Objects\DS1302.obj
COMPILER INVOKED BY: D:\Keil5\Keil5.38\C51\BIN\C51.EXE DS1302.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\List
                    -ings\DS1302.lst) TABS(2) OBJECT(.\Objects\DS1302.obj)

line level    source

   1          #include <stc12.h>
   2          #include "DS1302.h"
   3          #include <INTRINS.H>
   4          //引脚定义；
   5          sbit  DS1302_SCLK=P2^5;
   6          sbit  DS1302_IO=P2^4;
   7          sbit  DS1302_CE=P2^6;
   8           
   9          #define  DS1302_SECOND    0X80
  10          #define  DS1302_MINUTE    0X82
  11          #define  DS1302_HOUR      0X84
  12          #define  DS1302_DATE      0X86
  13          #define  DS1302_MONTH     0X88
  14          #define  DS1302_DAY       0X8A
  15          #define  DS1302_YEAR      0X8C
  16          #define  DS1302_WP        0X8E 
  17           
  18          //定义数组，用于存放设定的时间，年月日时分秒星期
  19          unsigned char DS1302_Time[7];//顺序：年月日时分秒星期
  20          
  21          // DS1302初始化
  22          void  DS1302_Init()
  23          {
  24   1        DS1302_CE=0;//将使能位置0，低电平；
  25   1        DS1302_SCLK=0;//将时钟位置0，低电平；
  26   1      }
  27           
  28          void DS1302_Write(unsigned char temp)
  29          {
  30   1        unsigned char i;
  31   1        for (i=0;i<8;i++)       
  32   1        { 
  33   2          DS1302_SCLK=0;
  34   2          DS1302_IO=temp&0x01;
  35   2          temp>>=1; 
  36   2          DS1302_SCLK=1;
  37   2        }
  38   1          
  39   1      }
  40          
  41          //DS1302单字节写入函数
  42          void  DS1302_WriteBety(unsigned char address,Data)
  43          {
  44   1        DS1302_CE=0;  
  45   1        _nop_();
  46   1      
  47   1        DS1302_SCLK=0;  
  48   1        _nop_();
  49   1      
  50   1        DS1302_CE=1;  
  51   1        _nop_();
  52   1        
  53   1        DS1302_Write(address);  
  54   1        DS1302_Write(Data);
C51 COMPILER V9.59.0.0   DS1302                                                            01/16/2025 15:48:23 PAGE 2   

  55   1        DS1302_CE=0; 
  56   1      }
  57           
  58          //DS1302单字节读出函数
  59          unsigned char   DS1302_ReadBety(unsigned char address)
  60          {
  61   1      unsigned char i,temp=0x00;
  62   1        DS1302_CE=0;  
  63   1        _nop_();
  64   1        DS1302_SCLK=0;  
  65   1        _nop_();
  66   1        DS1302_CE=1;  
  67   1        _nop_();
  68   1        DS1302_Write(address);
  69   1        for (i=0;i<8;i++)   
  70   1        { _nop_();  
  71   2          DS1302_SCLK=0;
  72   2          temp>>=1; 
  73   2          if(DS1302_IO)
  74   2          temp|=0x80; 
  75   2          DS1302_SCLK=1;
  76   2        } 
  77   1        DS1302_CE=0;  _nop_();
  78   1        DS1302_SCLK=0;  _nop_();
  79   1        DS1302_SCLK=1;  _nop_();
  80   1        DS1302_IO=0;  _nop_();
  81   1        DS1302_IO=1;  _nop_();
  82   1        return (temp);
  83   1      }
  84           
  85           
  86          //向DS1302内设定时间
  87          void DS1302_SetTime(unsigned char Date[])
  88          {
  89   1          DS1302_WriteBety(DS1302_WP, 0x00); // 关闭写保护
  90   1      
  91   1          DS1302_WriteBety(DS1302_YEAR, Date[0] / 10 * 16 + Date[0] % 10); // 写入年
  92   1          DS1302_WriteBety(DS1302_MONTH, Date[1] / 10 * 16 + Date[1] % 10); // 写入月
  93   1          DS1302_WriteBety(DS1302_DATE, Date[2] / 10 * 16 + Date[2] % 10); // 写入日
  94   1          DS1302_WriteBety(DS1302_HOUR, Date[3] / 10 * 16 + Date[3] % 10); // 写入时
  95   1          DS1302_WriteBety(DS1302_MINUTE, Date[4] / 10 * 16 + Date[4] % 10); // 写入分
  96   1          DS1302_WriteBety(DS1302_SECOND, Date[5] / 10 * 16 + Date[5] % 10); // 写入秒
  97   1          DS1302_WriteBety(DS1302_DAY, Date[6] / 10 * 16 + Date[6] % 10); // 写入星期
  98   1          DS1302_WriteBety(DS1302_WP, 0x80); // 开启写保护
  99   1      }
 100           
 101          //读取DS1302内时间
 102          void DS1302_ReadTime(unsigned char Date[])  
 103          {
 104   1        unsigned char Temp;//定义变量，用于暂时存储BCD码
 105   1          Temp=DS1302_ReadBety(0x8d);//读取年BCD码；
 106   1          Date[0]=Temp/16*10+Temp%16;//BCD码转十进制；
 107   1         Temp=DS1302_ReadBety(0x89);//读取月BCD码；
 108   1          Date[1]=Temp/16*10+Temp%16;//BCD码转十进制；
 109   1         Temp=DS1302_ReadBety(0x87);//读取日BCD码；
 110   1          Date[2]=Temp/16*10+Temp%16;//BCD码转十进制；
 111   1         Temp=DS1302_ReadBety(0x85);//读取小时BCD码；
 112   1          Date[3]=Temp/16*10+Temp%16;//BCD码转十进制；
 113   1         Temp=DS1302_ReadBety(0x83);//读取分钟BCD码；
 114   1          Date[4]=Temp/16*10+Temp%16;//BCD码转十进制；
 115   1         Temp=DS1302_ReadBety(0x81);//读取秒BCD码；
 116   1          Date[5]=Temp/16*10+Temp%16;//BCD码转十进制；
C51 COMPILER V9.59.0.0   DS1302                                                            01/16/2025 15:48:23 PAGE 3   

 117   1         Temp=DS1302_ReadBety(0x8b);//读取星期BCD码；
 118   1          Date[6]=Temp/16*10+Temp%16;//BCD码转十进制；
 119   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    570    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      7    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
